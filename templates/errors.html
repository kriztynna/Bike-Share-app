{% extends "base.html" %}
    {% block head %}
        <title>busybici: potential problems</title>
    {% endblock %}
	
    {%block body%}
        <h1>potential problem detector</h1>
            <p>NYC bike share provides data on each station's available bikes (keyword: availableBikes), availalble docks (availableDocks), and total docks (totalDocks). If all is working well, then the reported number of available bikes and available docks should sum to the reported total docks. In practice, this rarely happens, and the sum of available bikes and docks falls short of the expected number of total docks.</p>
            <p>The chart below illustrates the shortfall for each of the stations listed. To make the chart, a station must rank in the top 10 stations with potential problems. In the few instances when I've been able to visit one of the error-heavy stations, I've found that most errors can be explained by docks left holding out-of-service bikes. It's likely that some instances are the result of certain docks being out of service themselves. </p>
            <p>{{last_update_msg}}</p>
	    <hr>
	    <div id="chart_div"></div>

        <!-- JavaScript -->
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript">
        
          // Load the Visualization API and the piechart package.
          google.load('visualization', '1.0', {'packages':['corechart']});
          
          // Set a callback to run when the Google Visualization API is loaded.
          google.setOnLoadCallback(drawChart);

          // Callback that creates and populates a data table, 
          // instantiates the pie chart, passes in the data and
          // draws it.
          function drawChart() {

          // Create the data table.
          var data = new google.visualization.DataTable();
          data.addColumn('string', 'Station');
          data.addColumn('number', 'potential problems');
          {% for d in data_set%}
          data.addRows([[ {{d[0]|safe}}, {{d[1]}} ]])
          {% endfor %}

          // Set chart options
          var options = {
              title:'    ',
              colors: ['#C44D58'],
              backgroundColor:{stroke:"#FFFFFF"},
              width:1000,
              height:450,
              chartArea:{top:0,width:"60%",height:"90%"},
              fontSize:14,
              fontName:"Arial",
              hAxis:{minValue:0, baselineColor:"#556270",gridlines:{color:"#556270"}},
              vAxis:{baselineColor:"#FFFFFF",gridlines:{color:"#FFFFFF"}},
              lineWidth:3,
              legend: {position: 'none'},
              };

          // color palette: "cheer up emo kid" by electrikmonk at ColourLovers
          // available at http://www.colourlovers.com/palette/1930/cheer_up_emo_kid
          
          var chart = new google.visualization.BarChart(document.getElementById('chart_div'));
          chart.draw(data, options);
        }
        </script>
    {% endblock %}
