{% extends "base.html" %}
    {% block head %}
        <title>busybici: history</title>
    {% endblock %}
    {% block body %}
        <h1>historical station data</h1>
            <p>busybici has been collecting data on NYC bike share since late June 2013. Use this page to see how each station's availability of bikes and docks has trended over time.</p>
            <form action="/history" method="post">
                <select name="station_req" onchange="this.form.submit()">
                    {% for s in stations %}
                        {% set sel="" %}
                        {% if s.station_id == station_req %}
                            {% set sel="selected" %}
                        {% endif %}
                        <option value={{s.station_id}} {{sel}}>{{s.name}}</option>
                    {% endfor %}
                </select>
                <select name="time_req"  onchange="this.form.submit()">
                    {% for t in timespans %}
                        {% set sel="" %}
                        {% if t[1] == time_req %}
                            {% set sel="selected" %}
                        {% endif %}
                        <option value={{t[1]}} {{sel}}>{{t[0]}}</option>
                    {% endfor %}
                </select>
                <label class="checkbox">
                    <input type="checkbox" name="bikes_req" value="checked" {{bikes_req}}>
                    Available bikes
                </label>
                <label class="checkbox" display:inline>
                    <input type="checkbox" name="docks_req" value="checked" {{docks_req}}>
                    Available docks
                </label>
                <label class="checkbox" display:inline>
                    <input type="checkbox" name="errors_req" value="checked" {{errors_req}}>
                    Station errors
                </label>
                <input type="submit" value="Submit">
            </form>
	    <hr>
	    <div id="chart_div"></div>

        <!-- JavaScript -->
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript">
            google.load('visualization', '1.0', {'packages':['corechart']});
            google.setOnLoadCallback(drawChart);
            function drawChart() {
                var data = new google.visualization.DataTable();
                    data.addColumn('datetime', 'Time');
                    {% set single=0 %}
                    {% if bikes_req == "checked" %}
                        data.addColumn('number', 'Available bikes');
                        {% set single = single + 1 %}
                    {% endif %}
                    {% if docks_req == "checked" %}
                        data.addColumn('number', 'Available docks');
                        {% set single = single + 1 %}
                    {% endif %}
                    {% if errors_req == "checked" %}
                        data.addColumn('number', 'Station errors');
                        {% set single = single + 1 %}
                    {% endif %}
                    {% if single > 1 %}
                        {% for d in data_set %}
                            data.addRows([[ {{d[0]}}, {{d[1]}}, {{d[2]}}, {{d[3]}} ]]);
                        {% endfor %}
                    {% elif single == 1 %}
                        {% for d in data_set %}
                            data.addRows([[ {{d[0]}}, {{d[1]}} ]]);
                        {% endfor %}
                    {% endif %}

                var options = {
                    title:'    {{name|safe}}',
                    colors: {{color|safe}},
                    backgroundColor:{stroke:"#FFFFFF"},
                    height:500,
                    chartArea:{left:35,top:50,width:"80%",height:"80%"},
                    fontSize:14,
                    fontName:"Arial",
                    hAxis:{baselineColor:"#FFFFFF",gridlines:{color:"#FFFFFF"}},
                    vAxis:{baselineColor:"#556270",gridlines:{color:"#556270"},format:'#'},
                    lineWidth:3,
                    legend: {position: 'top'},
                    isStacked:true,
                    };
                // color palette: "cheer up emo kid" by electrikmonk at ColourLovers
                // available at http://www.colourlovers.com/palette/1930/cheer_up_emo_kid
                
                var chart = new google.visualization.AreaChart(document.getElementById('chart_div'));
                chart.draw(data, options);
            }
        </script>
    {% endblock %}