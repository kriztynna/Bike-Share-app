{% extends "base.html" %}
    {% block head %}
        <title>bike share app</title>
    {% endblock %}
	
    {%block body%}
        <h1>station history</h1>
            <p>this page shows the historical data for one station, {{name}}</p>
            <form action="/history" method="post">
                <select name="station_req" onchange="this.form.submit()">
                    {% for s in stations %}
                    {% set sel="" %}
                    {% if s.station_id == station_req %}
                        {% set sel="selected" %}
                    {% endif %}
                    <option value={{s.station_id}} {{sel}}>{{s.name}}</option>
                    {% endfor %}
                    </select>
            </form>
	    <hr>
	    <div id="chart_div"></div>

        <!-- Javascript -->
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript">
            google.load('visualization', '1.0', {'packages':['corechart']});
            google.setOnLoadCallback(drawChart);
            function drawChart() {
                var data = new google.visualization.DataTable();
                    data.addColumn('datetime', 'Time');
                    data.addColumn('number', 'Available bikes');
                    {% for h in history %}
                        {% set t=h.date_time %}
                        {% set t_UNIX=t.strftime('%s')+'000' %}
                        {% set tj = 'new Date('+t_UNIX+')' %}
                        data.addRows([[{{tj}}, {{h.availableBikes}} ]]);
                    {% endfor %}                                              
                var options = {
                    title:'Available bikes at {{name|safe}}',
                    width:1000,
                    height:500,
                    };
                var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
                chart.draw(data, options);
            }
        </script>

    {% endblock %}